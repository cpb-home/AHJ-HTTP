(()=>{"use strict";class t{static list(t){fetch("http://localhost:3005/?method=allTickets",{method:"GET"}).then((t=>t.json())).then((e=>t(e))).catch((e=>{throw t(0),new Error(`Ошибка получения всех тикетов: ${e}`)}))}static get(t,e){fetch(`http://localhost:3005/?method=ticketById&id=${t}`,{method:"GET"}).then((t=>t.json())).then((t=>e(t))).catch((t=>{throw new Error(`Ошибка получения тикета по ид: ${t}`)}))}static create(t,e){fetch("http://localhost:3005/?method=createTicket",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((t=>e(t))).catch((t=>{throw new Error(`Ошибка создания тикета: ${t}`)}))}static update(t,e,n){fetch(`http://localhost:3005/?method=updateById&id=${t}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>n(t))).catch((t=>{throw new Error(`Ошибка создания тикета: ${t}`)}))}static delete(t,e){fetch(`http://localhost:3005/?method=deleteById&id=${t}`,{method:"GET"}).then((t=>e(t))).catch((t=>{throw new Error(`Ошибка получения всех тикетов: ${t}`)}))}}class e{constructor({id:t,name:e,description:n,status:c,created:a}){this.id=t,this.name=e,this.description=n,this.status=c,this.created=a}}const n=document.getElementById("root");new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t}init(){const t=this.createTicketsCont();return this.container.append(t),this.getData(),this.container}createTicketsCont(){const t=document.createElement("div");t.className="pageCont";const e=this.createPopup();t.append(e);const n=this.createAddBtnCont();t.append(n);const c=this.createTicketsListCont();return t.append(c),t}createPopup(){const t=document.createElement("div");return t.className="popupCont",t}createAddBtnCont(){const t=document.createElement("div");t.className="addBtnCont";const e=this.createAddBtn();return t.append(e),t}createAddBtn(){const t=this.createBtn("Добавить тикет","button");return t.addEventListener("click",(t=>{const e=document.querySelector(".popupCont");if(e){e.textContent="";const t=this.createForm("add");e.style.display="block",e.append(t)}})),t}createForm(e,n=null){const c=document.createElement("form");c.classList="form";const a=document.createElement("h3");switch(e){case"delete":a.textContent="Удалить тикет",c.append(a);const t=document.createElement("p");t.textContent="Вы уверены, что хотите удалить данный тикет? Это действие нельзя будет отменить.",c.append(t),c.append(this.createBtnsCont());break;case"edit":a.textContent="Изменить тикет",c.append(a),c.append(this.createShortLabel()),c.append(this.createInput("edit",n)),c.append(this.createLongLabel()),c.append(this.createTextarea("edit",n)),c.append(this.createBtnsCont());break;case"add":a.textContent="Добавить тикет",c.append(a),c.append(this.createShortLabel()),c.append(this.createInput("add")),c.append(this.createLongLabel()),c.append(this.createTextarea("add")),c.append(this.createBtnsCont());break;default:a.textContent="Ошибка: что-то пошло не так!",c.append(a)}return c.addEventListener("submit",(c=>{if(c.preventDefault(),"delete"===e&&t.delete(n,(t=>{if(204===t.status){const t=document.querySelector(".popupCont");t.textContent="",t.style.display="none",this.getData()}})),"edit"===e){const e={name:c.target.elements.shortTextInp.value,description:c.target.elements.longTextInp.value};t.update(n,e,(t=>{if(200===t.status){const t=document.querySelector(".popupCont");t.textContent="",t.style.display="none",this.getData()}}))}if("add"===e){const e={name:c.target.elements.shortTextInp.value,description:c.target.elements.longTextInp.value};t.create(e,(t=>{if(200===t.status){const t=document.querySelector(".popupCont");t.textContent="",t.style.display="none",this.getData()}}))}})),c}createTicketsListCont(){const t=document.createElement("div");return t.className="ticketList",t.textContent="Пока нет записей",t}createBtn(t,e){const n=document.createElement("button");return n.className="btn",n.type=e,n.textContent=t,n.value=t,n}getData(){t.list((t=>{if("number"==typeof t){const t=document.querySelector(".pageCont"),e=document.createElement("h1");e.textContent="Не обнаружен сервер на порту 3005",t.textContent="",t.append(e)}else{localStorage.setItem("tickets",JSON.stringify(t));const n=JSON.parse(localStorage.getItem("tickets")),c=document.querySelector(".ticketList");if(c.textContent="",n.length>0){c.textContent="";for(let t=0;t<n.length;t++){const a=new e(n[t]);this.renderTicketCont(a);c.append(this.renderTicketCont(a))}}else c.textContent="Пока нет записей"}}))}createShortLabel(){return this.createLabel("shortTextInp","Краткое описание")}createLongLabel(){return this.createLabel("longTextInp","Подробное описание")}createLabel(t,e){const n=document.createElement("label");return n.htmlFor=t,n.className="label",n.textContent=e,n}createTextarea(e,n=null){const c=document.createElement("textarea");return c.classList="field longTextInp",c.id="longTextInp",c.name="description",c.required=!0,c.placeholder="Введите подробное описание","edit"===e&&t.get(n,(t=>{c.value=t.description||""})),c}createInput(e,n=null){const c=document.createElement("input");return c.classList="field shortTextInp",c.id="shortTextInp",c.type="text",c.name="name",c.required=!0,c.placeholder="Введите краткое описание","edit"===e&&t.get(n,(t=>{c.value=t.name||""})),c}createBtn(t,e){const n=document.createElement("button");return n.className="btn",n.type=e,n.textContent=t,n.value=t,n}createBtnsCont(){const t=document.createElement("div");t.className="btnsCont";const e=this.createBtn("Отмена","button");e.addEventListener("click",(t=>{const e=document.querySelector(".popupCont");e&&(e.style.display="none")})),t.append(e);const n=this.createBtn("Ok","submit");return t.append(n),t}renderTicketCont(t){const e=document.createElement("div");e.className="ticketCont",e.dataset.id=t.id;const n=document.createElement("div");return n.className="shortInfoCont",n.append(this.createCheckbox(t)),n.append(this.createBodyBox(t)),n.append(this.createBtnsbox(t)),e.append(n),e.append(this.createDescCont(t)),e}createCheckbox(t){const e=document.createElement("input");return e.className="ticketCbx",e.type="checkbox",e.checked=t.status,e}createTextbox(t){const e=document.createElement("div");return e.className="ticketTextCont",e.textContent=t.name,e}createDatebox(t){const e=document.createElement("div");e.className="ticketDateCont";return e.textContent=new Date(t.created).toLocaleDateString("ru",{year:"numeric",month:"numeric",day:"numeric",timezone:"UTC",hour:"numeric",minute:"numeric"}),e}createBtnsbox(t){const e=document.createElement("div");return e.className="ticketBtnsCont",e.append(this.createEditBtn(t)),e.append(this.createDelBtn(t)),e}createEditBtn(t){const e=document.createElement("button");return e.classList="btn ticketBtn editBtn",e.type="button",e.addEventListener("click",(e=>{const n=document.querySelector(".popupCont");if(n){n.textContent="";const e=this.createForm("edit",t.id);n.style.display="block",n.append(e)}})),e}createDelBtn(t){const e=document.createElement("button");return e.classList="btn ticketBtn delBtn",e.type="button",e.addEventListener("click",(e=>{const n=document.querySelector(".popupCont");if(n){n.textContent="";const e=this.createForm("delete",t.id);n.style.display="block",n.append(e)}})),e}createDescCont(t){const e=document.createElement("div");return e.className="descCont",e.textContent=t.description,e}createBodyBox(t){const e=document.createElement("div");return e.className="bodyCont",e.append(this.createTextbox(t)),e.append(this.createDatebox(t)),""!==t.description&&e.addEventListener("click",(e=>{document.querySelectorAll(".ticketCont").forEach((e=>{if(e.dataset.id===t.id){e.querySelector(".descCont").classList.toggle("descContVisible")}}))})),e}}(n).init()})();